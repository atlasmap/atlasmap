<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>NumberFieldActions.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Unit Test Coverage Report</a> &gt; <a href="../index.html" class="el_bundle">atlas-core</a> &gt; <a href="index.source.html" class="el_package">io.atlasmap.actions</a> &gt; <span class="el_source">NumberFieldActions.java</span></div><h1>NumberFieldActions.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2017 Red Hat, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.atlasmap.actions;

import java.math.BigDecimal;
import java.util.Collections;
import java.util.EnumMap;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import io.atlasmap.spi.AtlasActionProcessor;
import io.atlasmap.spi.AtlasFieldAction;
import io.atlasmap.v2.AbsoluteValue;
import io.atlasmap.v2.Add;
import io.atlasmap.v2.AreaUnitType;
import io.atlasmap.v2.Average;
import io.atlasmap.v2.Ceiling;
import io.atlasmap.v2.ConvertAreaUnit;
import io.atlasmap.v2.ConvertDistanceUnit;
import io.atlasmap.v2.ConvertMassUnit;
import io.atlasmap.v2.ConvertVolumeUnit;
import io.atlasmap.v2.DistanceUnitType;
import io.atlasmap.v2.Divide;
import io.atlasmap.v2.Floor;
import io.atlasmap.v2.MassUnitType;
import io.atlasmap.v2.Maximum;
import io.atlasmap.v2.Minimum;
import io.atlasmap.v2.Multiply;
import io.atlasmap.v2.Round;
import io.atlasmap.v2.Subtract;
import io.atlasmap.v2.VolumeUnitType;

/**
 * The number field actions.
 */
<span class="fc" id="L52">public class NumberFieldActions implements AtlasFieldAction {</span>
<span class="fc" id="L53">    private static final Logger LOG = LoggerFactory.getLogger(NumberFieldActions.class);</span>

    // 1D
    private static final double KILO_GRAMS_IN_A_POUND = 0.45359237;
    private static final double YARDS_IN_A_MILE = 1760.0;
    private static final double FEET_IN_A_YARD = 3.0;
    private static final double INCHES_IN_A_FOOT = 12.0;
    private static final double METERS_IN_A_INCH = 0.0254;
    // 2D
<span class="fc" id="L62">    private static final double SQUARE_FEET_IN_A_SQUARE_METER = Math.pow(1.0 / METERS_IN_A_INCH / INCHES_IN_A_FOOT,</span>
            2.0);
<span class="fc" id="L64">    private static final double SQUARE_METERS_IN_A_SQUARE_MILE = Math</span>
<span class="fc" id="L65">            .pow(YARDS_IN_A_MILE * FEET_IN_A_YARD * INCHES_IN_A_FOOT * METERS_IN_A_INCH, 2.0);</span>
<span class="fc" id="L66">    private static final double SQUARE_FEET_IN_A_SQUARE_MILE = Math.pow(YARDS_IN_A_MILE * FEET_IN_A_YARD, 2.0);</span>
    // 3D
    private static final double LITERS_IN_A_CUBIC_METER = 1000.0;
<span class="fc" id="L69">    private static final double CUBIC_FEET_IN_A_CUBIC_METER = Math.pow(1.0 / METERS_IN_A_INCH / INCHES_IN_A_FOOT, 3.0);</span>
    private static final double GALLONS_US_FLUID_IN_A_CUBIC_METER = 264.17205236;

    private static Map&lt;MassUnitType, Map&lt;MassUnitType, Double&gt;&gt; massConvertionTable;
    static {
<span class="fc" id="L74">        Map&lt;MassUnitType, Map&lt;MassUnitType, Double&gt;&gt; rootTable = new EnumMap&lt;&gt;(MassUnitType.class);</span>
<span class="fc" id="L75">        Map&lt;MassUnitType, Double&gt; kgRates = new EnumMap&lt;&gt;(MassUnitType.class);</span>
<span class="fc" id="L76">        kgRates.put(MassUnitType.KILOGRAM_KG, 1.0);</span>
<span class="fc" id="L77">        kgRates.put(MassUnitType.POUND_LB, 1.0 / KILO_GRAMS_IN_A_POUND);</span>
<span class="fc" id="L78">        rootTable.put(MassUnitType.KILOGRAM_KG, Collections.unmodifiableMap(kgRates));</span>
<span class="fc" id="L79">        Map&lt;MassUnitType, Double&gt; lbsRates = new EnumMap&lt;&gt;(MassUnitType.class);</span>
<span class="fc" id="L80">        lbsRates.put(MassUnitType.KILOGRAM_KG, KILO_GRAMS_IN_A_POUND);</span>
<span class="fc" id="L81">        lbsRates.put(MassUnitType.POUND_LB, 1.0);</span>
<span class="fc" id="L82">        rootTable.put(MassUnitType.POUND_LB, Collections.unmodifiableMap(lbsRates));</span>
<span class="fc" id="L83">        massConvertionTable = Collections.unmodifiableMap(rootTable);</span>
    }

    private static Map&lt;DistanceUnitType, Map&lt;DistanceUnitType, Double&gt;&gt; distanceConvertionTable;
    static {
<span class="fc" id="L88">        Map&lt;DistanceUnitType, Map&lt;DistanceUnitType, Double&gt;&gt; rootTable = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L89">        Map&lt;DistanceUnitType, Double&gt; mRates = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L90">        mRates.put(DistanceUnitType.METER_M, 1.0);</span>
<span class="fc" id="L91">        mRates.put(DistanceUnitType.FOOT_FT, 1.0 / METERS_IN_A_INCH / INCHES_IN_A_FOOT);</span>
<span class="fc" id="L92">        mRates.put(DistanceUnitType.YARD_YD, 1.0 / METERS_IN_A_INCH / INCHES_IN_A_FOOT / FEET_IN_A_YARD);</span>
<span class="fc" id="L93">        mRates.put(DistanceUnitType.MILE_MI, 1.0 / METERS_IN_A_INCH / INCHES_IN_A_FOOT / FEET_IN_A_YARD / YARDS_IN_A_MILE);</span>
<span class="fc" id="L94">        mRates.put(DistanceUnitType.INCH_IN, 1.0 / METERS_IN_A_INCH);</span>
<span class="fc" id="L95">        rootTable.put(DistanceUnitType.METER_M, Collections.unmodifiableMap(mRates));</span>
<span class="fc" id="L96">        Map&lt;DistanceUnitType, Double&gt; ftRates = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L97">        ftRates.put(DistanceUnitType.METER_M, INCHES_IN_A_FOOT * METERS_IN_A_INCH);</span>
<span class="fc" id="L98">        ftRates.put(DistanceUnitType.FOOT_FT, 1.0);</span>
<span class="fc" id="L99">        ftRates.put(DistanceUnitType.YARD_YD, 1.0 / FEET_IN_A_YARD);</span>
<span class="fc" id="L100">        ftRates.put(DistanceUnitType.MILE_MI, 1.0 / FEET_IN_A_YARD / YARDS_IN_A_MILE);</span>
<span class="fc" id="L101">        ftRates.put(DistanceUnitType.INCH_IN, INCHES_IN_A_FOOT);</span>
<span class="fc" id="L102">        rootTable.put(DistanceUnitType.FOOT_FT, Collections.unmodifiableMap(ftRates));</span>
<span class="fc" id="L103">        Map&lt;DistanceUnitType, Double&gt; ydRates = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L104">        ydRates.put(DistanceUnitType.METER_M, FEET_IN_A_YARD * INCHES_IN_A_FOOT * METERS_IN_A_INCH);</span>
<span class="fc" id="L105">        ydRates.put(DistanceUnitType.FOOT_FT, FEET_IN_A_YARD);</span>
<span class="fc" id="L106">        ydRates.put(DistanceUnitType.YARD_YD, 1.0);</span>
<span class="fc" id="L107">        ydRates.put(DistanceUnitType.MILE_MI, 1.0 / YARDS_IN_A_MILE);</span>
<span class="fc" id="L108">        ydRates.put(DistanceUnitType.INCH_IN, FEET_IN_A_YARD * INCHES_IN_A_FOOT);</span>
<span class="fc" id="L109">        rootTable.put(DistanceUnitType.YARD_YD, Collections.unmodifiableMap(ydRates));</span>
<span class="fc" id="L110">        Map&lt;DistanceUnitType, Double&gt; miRates = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L111">        miRates.put(DistanceUnitType.METER_M, YARDS_IN_A_MILE * FEET_IN_A_YARD * INCHES_IN_A_FOOT * METERS_IN_A_INCH);</span>
<span class="fc" id="L112">        miRates.put(DistanceUnitType.FOOT_FT, YARDS_IN_A_MILE * FEET_IN_A_YARD);</span>
<span class="fc" id="L113">        miRates.put(DistanceUnitType.YARD_YD, YARDS_IN_A_MILE);</span>
<span class="fc" id="L114">        miRates.put(DistanceUnitType.MILE_MI, 1.0);</span>
<span class="fc" id="L115">        miRates.put(DistanceUnitType.INCH_IN, YARDS_IN_A_MILE * FEET_IN_A_YARD * INCHES_IN_A_FOOT);</span>
<span class="fc" id="L116">        rootTable.put(DistanceUnitType.MILE_MI, Collections.unmodifiableMap(miRates));</span>
<span class="fc" id="L117">        Map&lt;DistanceUnitType, Double&gt; inRates = new EnumMap&lt;&gt;(DistanceUnitType.class);</span>
<span class="fc" id="L118">        inRates.put(DistanceUnitType.METER_M, METERS_IN_A_INCH);</span>
<span class="fc" id="L119">        inRates.put(DistanceUnitType.FOOT_FT, 1.0 / INCHES_IN_A_FOOT);</span>
<span class="fc" id="L120">        inRates.put(DistanceUnitType.YARD_YD, 1.0 / INCHES_IN_A_FOOT / FEET_IN_A_YARD);</span>
<span class="fc" id="L121">        inRates.put(DistanceUnitType.MILE_MI, 1.0 / INCHES_IN_A_FOOT / FEET_IN_A_YARD / YARDS_IN_A_MILE);</span>
<span class="fc" id="L122">        inRates.put(DistanceUnitType.INCH_IN, 1.0);</span>
<span class="fc" id="L123">        rootTable.put(DistanceUnitType.INCH_IN, Collections.unmodifiableMap(inRates));</span>
<span class="fc" id="L124">        distanceConvertionTable = Collections.unmodifiableMap(rootTable);</span>
    }

    private static Map&lt;AreaUnitType, Map&lt;AreaUnitType, Double&gt;&gt; areaConvertionTable;
    static {
<span class="fc" id="L129">        Map&lt;AreaUnitType, Map&lt;AreaUnitType, Double&gt;&gt; rootTable = new EnumMap&lt;&gt;(AreaUnitType.class);</span>
<span class="fc" id="L130">        Map&lt;AreaUnitType, Double&gt; m2Rates = new EnumMap&lt;&gt;(AreaUnitType.class);</span>
<span class="fc" id="L131">        m2Rates.put(AreaUnitType.SQUARE_METER, 1.0);</span>
<span class="fc" id="L132">        m2Rates.put(AreaUnitType.SQUARE_FOOT, SQUARE_FEET_IN_A_SQUARE_METER);</span>
<span class="fc" id="L133">        m2Rates.put(AreaUnitType.SQUARE_MILE, 1.0 / SQUARE_METERS_IN_A_SQUARE_MILE);</span>
<span class="fc" id="L134">        rootTable.put(AreaUnitType.SQUARE_METER, Collections.unmodifiableMap(m2Rates));</span>
<span class="fc" id="L135">        Map&lt;AreaUnitType, Double&gt; ft2Rates = new EnumMap&lt;&gt;(AreaUnitType.class);</span>
<span class="fc" id="L136">        ft2Rates.put(AreaUnitType.SQUARE_METER, 1.0 / SQUARE_FEET_IN_A_SQUARE_METER);</span>
<span class="fc" id="L137">        ft2Rates.put(AreaUnitType.SQUARE_FOOT, 1.0);</span>
<span class="fc" id="L138">        ft2Rates.put(AreaUnitType.SQUARE_MILE, 1.0 / SQUARE_FEET_IN_A_SQUARE_MILE);</span>
<span class="fc" id="L139">        rootTable.put(AreaUnitType.SQUARE_FOOT, Collections.unmodifiableMap(ft2Rates));</span>
<span class="fc" id="L140">        Map&lt;AreaUnitType, Double&gt; mi2Rates = new EnumMap&lt;&gt;(AreaUnitType.class);</span>
<span class="fc" id="L141">        mi2Rates.put(AreaUnitType.SQUARE_METER, SQUARE_METERS_IN_A_SQUARE_MILE);</span>
<span class="fc" id="L142">        mi2Rates.put(AreaUnitType.SQUARE_FOOT, SQUARE_FEET_IN_A_SQUARE_MILE);</span>
<span class="fc" id="L143">        mi2Rates.put(AreaUnitType.SQUARE_MILE, 1.0);</span>
<span class="fc" id="L144">        rootTable.put(AreaUnitType.SQUARE_MILE, Collections.unmodifiableMap(mi2Rates));</span>
<span class="fc" id="L145">        areaConvertionTable = Collections.unmodifiableMap(rootTable);</span>
    }

    private static Map&lt;VolumeUnitType, Map&lt;VolumeUnitType, Double&gt;&gt; volumeConvertionTable;
    static {
<span class="fc" id="L150">        Map&lt;VolumeUnitType, Map&lt;VolumeUnitType, Double&gt;&gt; rootTable = new EnumMap&lt;&gt;(VolumeUnitType.class);</span>
<span class="fc" id="L151">        Map&lt;VolumeUnitType, Double&gt; m3Rates = new EnumMap&lt;&gt;(VolumeUnitType.class);</span>
<span class="fc" id="L152">        m3Rates.put(VolumeUnitType.CUBIC_METER, 1.0);</span>
<span class="fc" id="L153">        m3Rates.put(VolumeUnitType.LITER, LITERS_IN_A_CUBIC_METER);</span>
<span class="fc" id="L154">        m3Rates.put(VolumeUnitType.CUBIC_FOOT, CUBIC_FEET_IN_A_CUBIC_METER);</span>
<span class="fc" id="L155">        m3Rates.put(VolumeUnitType.GALLON_US_FLUID, GALLONS_US_FLUID_IN_A_CUBIC_METER);</span>
<span class="fc" id="L156">        rootTable.put(VolumeUnitType.CUBIC_METER, Collections.unmodifiableMap(m3Rates));</span>
<span class="fc" id="L157">        Map&lt;VolumeUnitType, Double&gt; literRates = new EnumMap&lt;&gt;(VolumeUnitType.class);</span>
<span class="fc" id="L158">        literRates.put(VolumeUnitType.CUBIC_METER, 1.0 / LITERS_IN_A_CUBIC_METER);</span>
<span class="fc" id="L159">        literRates.put(VolumeUnitType.LITER, 1.0);</span>
<span class="fc" id="L160">        literRates.put(VolumeUnitType.CUBIC_FOOT, 1.0 / LITERS_IN_A_CUBIC_METER * CUBIC_FEET_IN_A_CUBIC_METER);</span>
<span class="fc" id="L161">        literRates.put(VolumeUnitType.GALLON_US_FLUID,</span>
<span class="fc" id="L162">                1.0 / LITERS_IN_A_CUBIC_METER * GALLONS_US_FLUID_IN_A_CUBIC_METER);</span>
<span class="fc" id="L163">        rootTable.put(VolumeUnitType.LITER, Collections.unmodifiableMap(literRates));</span>
<span class="fc" id="L164">        Map&lt;VolumeUnitType, Double&gt; cftRates = new EnumMap&lt;&gt;(VolumeUnitType.class);</span>
<span class="fc" id="L165">        cftRates.put(VolumeUnitType.CUBIC_METER, 1.0 / CUBIC_FEET_IN_A_CUBIC_METER);</span>
<span class="fc" id="L166">        cftRates.put(VolumeUnitType.LITER, 1.0 / CUBIC_FEET_IN_A_CUBIC_METER * LITERS_IN_A_CUBIC_METER);</span>
<span class="fc" id="L167">        cftRates.put(VolumeUnitType.CUBIC_FOOT, 1.0);</span>
<span class="fc" id="L168">        cftRates.put(VolumeUnitType.GALLON_US_FLUID,</span>
<span class="fc" id="L169">                1.0 / CUBIC_FEET_IN_A_CUBIC_METER * GALLONS_US_FLUID_IN_A_CUBIC_METER);</span>
<span class="fc" id="L170">        rootTable.put(VolumeUnitType.CUBIC_FOOT, Collections.unmodifiableMap(cftRates));</span>
<span class="fc" id="L171">        Map&lt;VolumeUnitType, Double&gt; galUsFluidRates = new EnumMap&lt;&gt;(VolumeUnitType.class);</span>
<span class="fc" id="L172">        galUsFluidRates.put(VolumeUnitType.CUBIC_METER, 1.0 / GALLONS_US_FLUID_IN_A_CUBIC_METER);</span>
<span class="fc" id="L173">        galUsFluidRates.put(VolumeUnitType.LITER, 1.0 / GALLONS_US_FLUID_IN_A_CUBIC_METER * LITERS_IN_A_CUBIC_METER);</span>
<span class="fc" id="L174">        galUsFluidRates.put(VolumeUnitType.CUBIC_FOOT,</span>
<span class="fc" id="L175">                1.0 / GALLONS_US_FLUID_IN_A_CUBIC_METER * CUBIC_FEET_IN_A_CUBIC_METER);</span>
<span class="fc" id="L176">        galUsFluidRates.put(VolumeUnitType.GALLON_US_FLUID, 1.0);</span>
<span class="fc" id="L177">        rootTable.put(VolumeUnitType.GALLON_US_FLUID, Collections.unmodifiableMap(galUsFluidRates));</span>
<span class="fc" id="L178">        volumeConvertionTable = Collections.unmodifiableMap(rootTable);</span>
<span class="fc" id="L179">    }</span>

    /**
     * Gets the absolute value.
     * @param action action model
     * @param input source
     * @return absolute value
     */
    @AtlasActionProcessor
    public static Number absoluteValue(AbsoluteValue action, Number input) {
<span class="fc bfc" id="L189" title="All 2 branches covered.">        if (input == null) {</span>
<span class="fc" id="L190">            return 0;</span>
        }
<span class="fc bfc" id="L192" title="All 2 branches covered.">        if (input instanceof BigDecimal) {</span>
<span class="fc" id="L193">            return ((BigDecimal) input).abs();</span>
        }
<span class="fc bfc" id="L195" title="All 2 branches covered.">        if (requiresDoubleResult(input)) {</span>
<span class="fc" id="L196">            return Math.abs(input.doubleValue());</span>
        }
<span class="fc" id="L198">        return Math.abs(input.longValue());</span>
    }

    /**
     * Calculates the addition.
     * @param action action model
     * @param inputs source
     * @return processed
     */
    @AtlasActionProcessor
    public static Number add(Add action, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L209" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L210">            return 0;</span>
        }

<span class="fc" id="L213">        Number sum = 0L;</span>
<span class="fc bfc" id="L214" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L215" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="fc bfc" id="L216" title="All 2 branches covered.">                if (sum instanceof BigDecimal) {</span>
<span class="fc" id="L217">                    sum = ((BigDecimal) sum).add(BigDecimal.valueOf(((Number) entry).doubleValue()));</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">                } else if (entry instanceof BigDecimal) {</span>
<span class="fc" id="L219">                    sum = BigDecimal.valueOf(sum.doubleValue()).add((BigDecimal) entry);</span>
<span class="fc bfc" id="L220" title="All 4 branches covered.">                } else if (requiresDoubleResult(sum) || requiresDoubleResult(entry)) {</span>
<span class="fc" id="L221">                    sum = sum.doubleValue() + ((Number) entry).doubleValue();</span>
                } else {
<span class="fc" id="L223">                    sum = sum.longValue() + ((Number) entry).longValue();</span>
                }
            } else {
<span class="fc" id="L226">                warnIgnoringValue(&quot;Add&quot;, entry);</span>
            }
<span class="fc" id="L228">        }</span>

<span class="fc" id="L230">        return sum;</span>
    }

    /**
     * Gets the average.
     * @param action action model
     * @param inputs a list of source objects
     * @return average
     */
    @AtlasActionProcessor
    public static Number average(Average action, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L241" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L242">            return 0;</span>
        }
<span class="fc" id="L244">        return add(null, inputs).doubleValue() / inputs.size();</span>
    }

    /**
     * Gets the ceiling.
     * @param action action model
     * @param input source
     * @return ceiling
     */
    @AtlasActionProcessor
    public static Number ceiling(Ceiling action, Number input) {
<span class="fc bfc" id="L255" title="All 2 branches covered.">        return input == null ? 0L : (long)Math.ceil(input.doubleValue());</span>
    }

    /**
     * Converts mass unit.
     * @param convertMassUnit action model
     * @param input source
     * @return converted
     */
    @AtlasActionProcessor
    public static Number convertMassUnit(ConvertMassUnit convertMassUnit, Number input) {
<span class="fc bfc" id="L266" title="All 2 branches covered.">        if (input == null) {</span>
<span class="fc" id="L267">            return 0;</span>
        }

<span class="pc bpc" id="L270" title="1 of 4 branches missed.">        if (convertMassUnit == null || convertMassUnit.getFromUnit() == null</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">                || convertMassUnit.getToUnit() == null) {</span>
<span class="fc" id="L272">            throw new IllegalArgumentException(&quot;ConvertMassUnit must be specified  with fromUnit and toUnit&quot;);</span>
        }

<span class="fc" id="L275">        MassUnitType fromUnit = convertMassUnit.getFromUnit();</span>
<span class="fc" id="L276">        MassUnitType toUnit = convertMassUnit.getToUnit();</span>
<span class="fc" id="L277">        double rate = massConvertionTable.get(fromUnit).get(toUnit);</span>
<span class="fc" id="L278">        return doMultiply(input, rate);</span>
    }

    /**
     * Converts distance unit.
     * @param convertDistanceUnit action model
     * @param input source
     * @return converted
     */
    @AtlasActionProcessor
    public static Number convertDistanceUnit(ConvertDistanceUnit convertDistanceUnit, Number input) {
<span class="fc bfc" id="L289" title="All 2 branches covered.">        if (input == null) {</span>
<span class="fc" id="L290">            return 0;</span>
        }

<span class="pc bpc" id="L293" title="1 of 4 branches missed.">        if (convertDistanceUnit == null || convertDistanceUnit.getFromUnit() == null</span>
<span class="pc bpc" id="L294" title="1 of 2 branches missed.">                || convertDistanceUnit.getToUnit() == null) {</span>
<span class="fc" id="L295">            throw new IllegalArgumentException(&quot;ConvertDistanceUnit must be specified  with fromUnit and toUnit&quot;);</span>
        }

<span class="fc" id="L298">        DistanceUnitType fromUnit = convertDistanceUnit.getFromUnit();</span>
<span class="fc" id="L299">        DistanceUnitType toUnit = convertDistanceUnit.getToUnit();</span>
<span class="fc" id="L300">        double rate = distanceConvertionTable.get(fromUnit).get(toUnit);</span>
<span class="fc" id="L301">        return doMultiply(input, rate);</span>
    }

    /**
     * Converts area unit.
     * @param convertAreaUnit action model
     * @param input source
     * @return converted
     */
    @AtlasActionProcessor
    public static Number convertAreaUnit(ConvertAreaUnit convertAreaUnit, Number input) {
<span class="fc bfc" id="L312" title="All 2 branches covered.">        if (input == null) {</span>
<span class="fc" id="L313">            return 0;</span>
        }

<span class="pc bpc" id="L316" title="1 of 4 branches missed.">        if (convertAreaUnit == null || convertAreaUnit.getFromUnit() == null</span>
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">                || convertAreaUnit.getToUnit() == null) {</span>
<span class="fc" id="L318">            throw new IllegalArgumentException(&quot;ConvertAreaUnit must be specified  with fromUnit and toUnit&quot;);</span>
        }

<span class="fc" id="L321">        AreaUnitType fromUnit = convertAreaUnit.getFromUnit();</span>
<span class="fc" id="L322">        AreaUnitType toUnit = convertAreaUnit.getToUnit();</span>
<span class="fc" id="L323">        double rate = areaConvertionTable.get(fromUnit).get(toUnit);</span>
<span class="fc" id="L324">        return doMultiply(input, rate);</span>
    }

    /**
     * Converts volume unit.
     * @param convertVolumeUnit action model
     * @param input source
     * @return converted
     */
    @AtlasActionProcessor
    public static Number convertVolumeUnit(ConvertVolumeUnit convertVolumeUnit, Number input) {
<span class="fc bfc" id="L335" title="All 2 branches covered.">        if (input == null) {</span>
<span class="fc" id="L336">            return 0;</span>
        }

<span class="pc bpc" id="L339" title="1 of 4 branches missed.">        if (convertVolumeUnit == null || convertVolumeUnit.getFromUnit() == null</span>
<span class="pc bpc" id="L340" title="1 of 2 branches missed.">                || convertVolumeUnit.getToUnit() == null) {</span>
<span class="fc" id="L341">            throw new IllegalArgumentException(&quot;ConvertVolumeUnit must be specified  with fromUnit and toUnit&quot;);</span>
        }

<span class="fc" id="L344">        VolumeUnitType fromUnit = convertVolumeUnit.getFromUnit();</span>
<span class="fc" id="L345">        VolumeUnitType toUnit = convertVolumeUnit.getToUnit();</span>
<span class="fc" id="L346">        double rate = volumeConvertionTable.get(fromUnit).get(toUnit);</span>
<span class="fc" id="L347">        return doMultiply(input, rate);</span>
    }

    /**
     * Calculates the division.
     * @param divide action model
     * @param inputs a list of source objects
     * @return calculated
     */
    @AtlasActionProcessor
    public static Number divide(Divide divide, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L358" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L359">            return 0;</span>
        }

<span class="fc" id="L362">        Number quotient = null;</span>
<span class="fc bfc" id="L363" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L364" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="fc bfc" id="L365" title="All 2 branches covered.">                if (quotient == null) {</span>
<span class="fc" id="L366">                    quotient = (Number) entry;</span>
<span class="fc bfc" id="L367" title="All 2 branches covered.">                } else if (quotient instanceof BigDecimal) {</span>
<span class="fc" id="L368">                    quotient = ((BigDecimal) quotient).divide(BigDecimal.valueOf(((Number) entry).doubleValue()));</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">                } else if (entry instanceof BigDecimal) {</span>
<span class="nc" id="L370">                    quotient = BigDecimal.valueOf(quotient.doubleValue()).divide((BigDecimal) entry);</span>
                } else {
<span class="fc" id="L372">                    quotient = quotient.doubleValue() / ((Number) entry).doubleValue();</span>
                }
            } else {
<span class="fc" id="L375">                warnIgnoringValue(&quot;Divide&quot;, entry);</span>
            }
<span class="fc" id="L377">        }</span>

<span class="fc" id="L379">        return quotient;</span>
    }

    /**
     * Gets the floor.
     * @param floor action model
     * @param input source
     * @return floor
     */
    @AtlasActionProcessor
    public static Number floor(Floor floor, Number input) {
<span class="fc bfc" id="L390" title="All 2 branches covered.">        return input == null ? 0L : (long)Math.floor(input.doubleValue());</span>
    }

    /**
     * Gets the maximum.
     * @param maximum action model
     * @param inputs a list of source objects
     * @return maximum
     */
    @AtlasActionProcessor
    public static Number maximum(Maximum maximum, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L401" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L402">            return 0;</span>
        }

<span class="fc" id="L405">        Number max = null;</span>
<span class="fc bfc" id="L406" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="pc bpc" id="L408" title="1 of 4 branches missed.">                if (max instanceof BigDecimal &amp;&amp; entry instanceof BigDecimal) {</span>
<span class="fc" id="L409">                    max = ((BigDecimal) entry).max((BigDecimal)max);</span>
<span class="pc bpc" id="L410" title="1 of 4 branches missed.">                } else if (max == null || ((Number) entry).doubleValue() &gt; max.doubleValue()) {</span>
<span class="fc" id="L411">                    max = (Number) entry;</span>
                }
            } else {
<span class="fc" id="L414">                warnIgnoringValue(&quot;Maximum&quot;, entry);</span>
            }
<span class="fc" id="L416">        }</span>

<span class="fc" id="L418">        return max;</span>
    }

    /**
     * Gets the minumum.
     * @param minimum action model
     * @param inputs a list of source objects
     * @return minumum
     */
    @AtlasActionProcessor
    public static Number minimum(Minimum minimum, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L429" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L430">            return 0;</span>
        }

<span class="fc" id="L433">        Number min = null;</span>
<span class="fc bfc" id="L434" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L435" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="pc bpc" id="L436" title="1 of 4 branches missed.">                if (min instanceof BigDecimal &amp;&amp; entry instanceof BigDecimal) {</span>
<span class="fc" id="L437">                    min = ((BigDecimal) entry).min((BigDecimal)min);</span>
<span class="pc bpc" id="L438" title="1 of 4 branches missed.">                } else if (min == null || ((Number) entry).doubleValue() &lt; min.doubleValue()) {</span>
<span class="fc" id="L439">                    min = (Number) entry;</span>
                }
            } else {
<span class="fc" id="L442">                warnIgnoringValue(&quot;Minimum&quot;, entry);</span>
            }
<span class="fc" id="L444">        }</span>

<span class="fc" id="L446">        return min;</span>
    }

    /**
     * Calculates the multiplication.
     * @param multiply action model
     * @param inputs a list of source objects
     * @return calculated
     */
    @AtlasActionProcessor
    public static Number multiply(Multiply multiply, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L457" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L458">            return 0;</span>
        }

<span class="fc" id="L461">        Number product = 1L;</span>
<span class="fc bfc" id="L462" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L463" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="fc bfc" id="L464" title="All 2 branches covered.">                if (product instanceof BigDecimal) {</span>
<span class="fc" id="L465">                    product = ((BigDecimal) product).multiply(BigDecimal.valueOf(((Number) entry).doubleValue()));</span>
<span class="fc bfc" id="L466" title="All 2 branches covered.">                } else if (entry instanceof BigDecimal) {</span>
<span class="fc" id="L467">                    product = BigDecimal.valueOf(product.doubleValue()).multiply((BigDecimal) entry);</span>
<span class="fc bfc" id="L468" title="All 4 branches covered.">                } else if (requiresDoubleResult(product) || requiresDoubleResult(entry)) {</span>
<span class="fc" id="L469">                    product = product.doubleValue() * ((Number) entry).doubleValue();</span>
                } else {
<span class="fc" id="L471">                    product = product.longValue() * ((Number) entry).longValue();</span>
                }
            } else {
<span class="fc" id="L474">                warnIgnoringValue(&quot;Multiply&quot;, entry);</span>
            }
<span class="fc" id="L476">        }</span>

<span class="fc" id="L478">        return product;</span>
    }

    /**
     * Gets the round.
     * @param action action model
     * @param input source
     * @return round
     */
    @AtlasActionProcessor
    public static Number round(Round action, Number input) {
<span class="fc bfc" id="L489" title="All 2 branches covered.">        return input == null ? 0L : Math.round(input.doubleValue());</span>
    }

    /**
     * Calculates the subtraction.
     * @param subtract action model
     * @param inputs source
     * @return calculated
     */
    @AtlasActionProcessor
    public static Number subtract(Subtract subtract, List&lt;Number&gt; inputs) {
<span class="fc bfc" id="L500" title="All 2 branches covered.">        if (inputs == null) {</span>
<span class="fc" id="L501">            return 0;</span>
        }

<span class="fc" id="L504">        Number difference = null;</span>
<span class="fc bfc" id="L505" title="All 2 branches covered.">        for (Object entry : inputs) {</span>
<span class="fc bfc" id="L506" title="All 2 branches covered.">            if (entry instanceof Number) {</span>
<span class="fc bfc" id="L507" title="All 2 branches covered.">                if (difference == null) {</span>
<span class="fc" id="L508">                    difference = (Number) entry;</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">                } else if (difference instanceof BigDecimal) {</span>
<span class="fc" id="L510">                    difference = ((BigDecimal) difference).subtract(BigDecimal.valueOf(((Number) entry).doubleValue()));</span>
<span class="pc bpc" id="L511" title="1 of 2 branches missed.">                } else if (entry instanceof BigDecimal) {</span>
<span class="nc" id="L512">                    difference = BigDecimal.valueOf(difference.doubleValue()).subtract((BigDecimal) entry);</span>
<span class="pc bpc" id="L513" title="1 of 4 branches missed.">                } else if (requiresDoubleResult(difference) || requiresDoubleResult(entry)) {</span>
<span class="fc" id="L514">                    difference = difference.doubleValue() - ((Number) entry).doubleValue();</span>
                } else {
<span class="fc" id="L516">                    difference = difference.longValue() - ((Number) entry).longValue();</span>
                }
            } else {
<span class="fc" id="L519">                warnIgnoringValue(&quot;Subtract&quot;, entry);</span>
            }
<span class="fc" id="L521">        }</span>

<span class="fc" id="L523">        return difference;</span>
    }

    private static Number doMultiply(Number input, double rate) {
<span class="fc bfc" id="L527" title="All 2 branches covered.">        if (input instanceof BigDecimal) {</span>
<span class="fc" id="L528">            return ((BigDecimal) input).multiply(BigDecimal.valueOf(rate));</span>
        }
<span class="fc" id="L530">        return (input.doubleValue() * rate);</span>
    }

    private static boolean requiresDoubleResult(Object object) {
<span class="fc bfc" id="L534" title="All 4 branches covered.">        return object instanceof Double || object instanceof Float;</span>
    }

    /**
     * @TODO Add audit via @AtlasSession instead - https://github.com/atlasmap/atlasmap/issues/1269
     * @param value value
     */
    private static void warnIgnoringValue(String action, Object value) {
<span class="fc" id="L542">        LOG.warn(&quot;The source collection/arry/map must only contain numbers for '{}' transformation - ignoring '{}'&quot;,</span>
<span class="pc bpc" id="L543" title="1 of 2 branches missed.">            action, value != null ? value : &quot;null&quot;);</span>
<span class="fc" id="L544">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>